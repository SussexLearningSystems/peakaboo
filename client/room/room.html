<template name="room_nav">
  <ul class="nav nav-pills">
    <li class="{{#if controls}}active{{/if}}"><a href="{{pathFor 'room_controls' _id=room._id}}" class="room_tab">Controls</a></li>
    <li class="{{#if repository}}active{{/if}}"><a href="{{pathFor 'room_repository' _id=room._id}}" class="room_tab">Repository</a></li>
  </ul>
  <hr>
</template>

<template name="room_controls">
  {{> room_nav}}
  {{#with room}}
  <div class="row">
    <div class="col-md-6">
      <div class="panel {{#if roomOffline}}panel-danger{{else}}panel-default{{/if}}">
        <div class="panel-heading">
          <h3 class="panel-title">{{displayName}}{{#if roomOffline}} <span data-toggle="tooltip" data-placement="top" title="Last seen: {{roomOffline.time}}"> - offline for: {{roomOffline.ago}}</span>{{/if}} {{#if recording}}<span class="label label-danger pull-right">Rec</span>{{/if}}{{#if paused}}{{>paused}}{{/if}}</h3>
        </div>
        <div class="panel-body">
          <a href="#" class="thumbnail">
            <img data-src="holder.js/100%" src="{{thumbnail}}">
          </a>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      {{#if recording}}
      <div class="row">
        <div class="col-md-12">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Recording metadata</h3>
            </div>
            {{#with metadata currentMediaPackage}}
            {{>metadata}}
            {{/with}}
          </div>
        </div>
      </div>
      {{/if}}
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Audio</h3>
            </div>
            <div class="panel-body">
              {{>vumeter}}
              <label>Rear Mic Boost</label><input type="range" class="audioFaders" name="rear-mic-boost" id="rearMicBoost" min="{{audio.rearMicBoost.limits.min}}" max="{{audio.rearMicBoost.limits.max}}" value="{{audio.rearMicBoost.value.left}}">
              <label>Capture</label><input type="range" class="audioFaders" name="capture" id="capture" min="{{audio.capture.limits.min}}" max="{{audio.capture.limits.max}}" value="{{audio.capture.value.left}}">
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Controls</h3>
            </div>
            <div class="panel-body">
              <div class="panel-body peakaboo-controls">
                <div class="row">
                  <div class="col-xs-4 text-center">
                    <button type="button" id="peakaboo-rec-button" class="btn {{#if recording}}btn-danger{{else}}btn-default{{/if}} {{#if recording}}disabled{{/if}}" title="Start Recording"><i class="glyphicon glyphicon-record text-danger"></i></button>
                  </div>
                  <div class="col-xs-4 text-center">
                    <button type="button" id="peakaboo-pause-button" class="btn {{#if paused}}btn-info{{else}}btn-default{{/if}} {{#unless recording}}disabled{{/unless}}" title="Pause Recording"><i class="glyphicon glyphicon-pause"></i></button>
                  </div>
                  <div class="col-xs-4 text-center">
                    <button type="button" id="peakaboo-stop-button" class="btn btn-default {{#unless recording}}disabled{{/unless}}" title="Stop Recording"><i class="glyphicon glyphicon-stop"></i></button>
                  </div>
                </div>
                <div class="row margin-top-05">
                  <div class="col-xs-6 text-center">
                    <button type="button" data-toggle="modal" data-target="#mymodal" data-action="restart" data-title="Restart galicaster" data-message="Are you sure you want to restart galicaster on <b>{{displayName}}</b>?" data-confirm="Restart" class="btn btn-warning peakaboo-command">Restart galicaster</button>
                  </div>
                  <div class="col-xs-6 text-center">
                    <button type="button" data-toggle="modal" data-target="#mymodal" data-action="reboot" data-title="Reboot machine" data-message="Are you sure you want to reboot <b>{{displayName}}</b>?" data-confirm="Reboot" class="btn btn-danger peakaboo-command">Reboot machine</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {{/with}}
  {{>confirmModal}}
</template>

<template name="room_repository">
  {{> room_nav}}
  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Repository</h3>
        </div>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Date</th><th>Name</th><th>Presenter</th><th>Series</th><th>Duration</th>
            </tr>
          </thead>
          <tbody>
          {{#each room.repository}}
            {{>tableRow}}
          {{/each}}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</template>

<template name="tableRow">
  <tr>
    <td>{{mcreated}}</td><td>{{title}}</td><td>{{creator}}</td><td>{{series_title}}</td><td>{{mduration}}</td>
  </tr>
</template>

<template name="confirmModal">
  <div id="mymodal" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">{{modal.title}}</h4>
        </div>
        <div class="modal-body">
          <p>{{{modal.message}}}</p>
          {{#if commandError}}
          <div class="alert alert-danger">{{commandError}}</div>
          {{/if}}
        </div>
        <div class="modal-footer">
          <button id="modalOk" type="button" class="btn btn-danger ladda-button" data-style="expand-left" data-spinner-size="32"><span class="ladda-label">{{modal.confirm}}</span></button>
          <button id="modalCancel" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</template>
